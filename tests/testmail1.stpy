from email.mime.image import MIMEImage

@StrigaViewEntry
def main(ctx, out):
	
	ctx.res.Subject = 'Test mail - žluťoučký kůň'
	ctx.res.From = ctx.req.Vars.MAIL['mailfrom']
	ctx.res.To.extend(ctx.req.Vars.MAIL['mailto'].split(','))

	mailcc = ctx.req.Vars.MAIL.get('mailcc')
	if mailcc is not None:
		ctx.res.CC.extend(mailcc.split(','))

	mailbcc = ctx.req.Vars.MAIL.get('mailbcc')
	if mailbcc is not None:
		ctx.res.BCC.extend(mailbcc.split(','))

	=|~| StrigaFileInfo.BuildMode.DocumentHeader
	<html:
		<head:
			<title:="Test email"

		<body:
			<h1: ='Hello from Striga'
			="This is email generated by Striga engine!"

			<br

			cidid = "img-{0}".format(ctx.UniqueNumberGenerator.next())
			<img src="cid:{0}".format(cidid)
			ctx.res.AddContent(MIMEImage(open('./tests/testimage.jpg','rb').read(), _subtype='jpeg'), cidid)


	# Add regular attachment
	ctx.res.AddAttachment(MIMEImage(open('./tests/testimage.jpg','rb').read(), _subtype='jpeg'), 'testimage.jpg')
